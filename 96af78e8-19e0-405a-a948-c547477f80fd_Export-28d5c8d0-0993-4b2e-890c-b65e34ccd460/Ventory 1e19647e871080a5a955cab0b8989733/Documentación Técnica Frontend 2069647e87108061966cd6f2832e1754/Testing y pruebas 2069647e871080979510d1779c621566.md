# Testing y pruebas

Guía para asegurar la calidad del código mediante pruebas automáticas y manuales en Ventory.

---

## Principios generales

- Todas las nuevas funcionalidades deben incluir **pruebas unitarias** y, si aplica, **pruebas de integración**.
- Usa **mocks** para dependencias externas y para aislar la lógica de los servicios.
- Corre las pruebas localmente antes de realizar un merge o despliegue.
- Revisa la cobertura de pruebas y prioriza los casos críticos del negocio.

---

## Backend (NestJS + Jest)

- Utiliza **Jest** para pruebas unitarias y de integración.
- Estructura recomendada:
    - Crea archivos `.spec.ts` junto a cada servicio, controlador o módulo que quieras testear.
- Prueba casos positivos y negativos:
    - Ejemplo: login exitoso, login con credenciales incorrectas, acceso no autorizado, etc.

**Ejemplo de prueba unitaria para AuthService:**

```tsx
describe('AuthService', () => {
  let service: AuthService;

  beforeEach(async () => {
    // Configura el módulo de prueba y mocks aquí
  });

  it('debería validar usuario correctamente', async () => {
    // Arrange
    // Act
    // Assert
  });

  it('debería rechazar usuario con contraseña incorrecta', async () => {
    // Arrange
    // Act
    // Assert
  });
});

```

## Frontend (Angular + Jasmine/Karma)

**Ejemplo de prueba para un servicio Angular:**

```jsx
describe('UsersService', () => {
  let service: UsersService;
  let httpMock: HttpTestingController;

  beforeEach(() => {
    TestBed.configureTestingModule({
      providers: [UsersService],
      imports: [HttpClientTestingModule],
    });
    service = TestBed.inject(UsersService);
    httpMock = TestBed.inject(HttpTestingController);
  });

  it('debe obtener todos los usuarios', () => {
    service.getAll().subscribe(users => {
      expect(users.length).toBeGreaterThan(0);
    });

    const req = httpMock.expectOne('http://localhost:3001/api/users');
    expect(req.request.method).toBe('GET');
    req.flush([{ id: 1, name: 'Test User' }]);
  });
});

```

## Pruebas manuales

- Antes de lanzar cambios a producción, valida manualmente los principales flujos críticos (login, registro, gestión de roles y permisos, creación y eliminación de usuarios/pedidos).
- Documenta los casos de prueba manuales más importantes en Notion o en tu sistema de gestión de calidad.

---

## Recomendaciones

- Usa comandos automáticos (`npm test`, `ng test`) en los pipelines de integración continua (CI/CD).
- Mantén una cobertura mínima aceptable y revisa las alertas de pruebas fallidas.
- Actualiza y revisa periódicamente los tests después de refactors o cambios importantes en la lógica de negocio.
- Integra herramientas de análisis de cobertura (por ejemplo, **coverage** de Jest/Karma).