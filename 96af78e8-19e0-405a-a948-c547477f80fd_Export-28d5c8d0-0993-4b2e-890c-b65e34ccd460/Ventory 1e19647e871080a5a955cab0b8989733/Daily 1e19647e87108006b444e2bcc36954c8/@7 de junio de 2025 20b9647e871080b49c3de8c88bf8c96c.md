# @7 de junio de 2025

## üìù **Daily ‚Äì Implementaci√≥n y pruebas de refresh token autom√°tico en Ventory**

### **Logros y avances**

- **Implementado refresh token autom√°tico:**
    - El backend ahora genera y valida access tokens (15 min) y refresh tokens (7 d√≠as).
    - Al expirar el access token, el frontend solicita y actualiza ambos tokens autom√°ticamente usando el refresh token sin requerir acci√≥n del usuario.
- **Creado y corregido interceptor de clase en Angular:**
    - El interceptor maneja la renovaci√≥n transparente del access token ante errores 401, e implementa logout autom√°tico si el refresh token es inv√°lido o expir√≥.
- **Ajuste de flujo de logout:**
    - Ahora el logout elimina access token, refresh token, usuario y userId del localStorage solo despu√©s de notificar al backend, asegurando el cierre seguro de sesi√≥n.
    - Se solucion√≥ el bug del userId = 0, guardando expl√≠citamente el id del usuario en localStorage tras el login.
- **Validaci√≥n exhaustiva del flujo:**
    - Se prob√≥ exitosamente el login, logout, cierre y reapertura del navegador, expiraci√≥n de tokens y actualizaci√≥n autom√°tica de sesi√≥n.
    - Verificado que los cambios de permisos/roles requieren renovaci√≥n de token para reflejarse en la app.
- **Documentaci√≥n de buenas pr√°cticas:**
    - Aclarada la diferencia entre interceptores de funci√≥n y clase en Angular, y la correcta configuraci√≥n del app.config con `withInterceptorsFromDi()` para l√≥gica avanzada.
- **Flujo profesional y seguro:**
    - El sistema ahora evita que sesiones ‚Äúfantasma‚Äù muestren recursos inconsistentes o sin permisos tras cambios en backend.
    
    # Listas
    
- Se cre√≥ el recurso centralizado de cat√°logos (`ListType` y `ListItem`) en el backend usando NestJS y Prisma.
- Se defini√≥ el modelo relacional en Prisma, permitiendo que cada √≠tem de lista pertenezca a un tipo de lista configurable (por ejemplo: Marca, Unidad de medida, Tipo de m√°quina, etc.).
- Se implementaron los endpoints CRUD para ambos recursos.
- Se ajustaron y validaron los DTOs para garantizar integridad y tipo de datos correcto.
- Se probaron los endpoints mediante Postman, confirmando funcionamiento para creaci√≥n, consulta y filtrado por tipo.
- Se documentaron buenas pr√°cticas para mantener la consistencia y escalabilidad del m√≥dulo de listas en el sistema.