# @2 de junio de 2025

### **Daily – 01/06/2025**

**Objetivo:**

Finalizar protección de endpoints mediante sistema robusto de autenticación y permisos.

**Avances:**

- Se detectó y solucionó un problema crítico en la protección de rutas de usuarios.
- Se identificó que el guard de permisos (`PermissionsGuard`) se ejecutaba antes que el de autenticación (`JwtAuthGuard`), lo que generaba errores 403 y `request.user` como undefined.
- Se corrigió el flujo registrando ambos guards como globales en AppModule, asegurando el orden correcto (autenticación primero).
- Se eliminaron decoradores innecesarios de guards a nivel de controlador, dejando todo gestionado globalmente.
- Se añadieron logs de depuración para comprobar correctamente la llegada de usuario y permisos.
- Validación de permisos y visualización del CRUD de usuarios funcionando correctamente según roles asignados.

**Retos:**

- Entender el orden de ejecución de guards globales en NestJS.
- Evitar duplicación de guards y problemas de contexto.

- **Migración de branding:**
    - Se actualizó el nombre del proyecto de “Sakai” a **“Ventory”** en todos los archivos clave (`package.json`, `angular.json`, rutas de build y referencias internas).
- **Documentación técnica:**
    - Se personalizó el archivo **README.md** para reflejar correctamente la información y comandos del proyecto Ventory.
    - Se regeneró la documentación automática del frontend usando **Compodoc**, asegurando que ya no aparecen referencias a Sakai y todo el contenido está actualizado.
    - Se añadió en Notion, dentro de la **introducción de la documentación técnica del frontend**, la indicación de que usamos Compodoc para documentar y cómo consultar/actualizar la doc.
- **Validación:**
    - Verificado que el build, el servidor de desarrollo y la documentación generada funcionen correctamente bajo el nuevo nombre.
- **Próximos pasos:**
    - Continuar agregando comentarios JSDoc a servicios y componentes clave.

**Avance en gestión de roles y permisos (backend):**

- Se depuró y corrigió el flujo de asignación de permisos a roles desde el backend (NestJS + Prisma).
- El error 500 al actualizar los permisos se debía a que se estaban enviando los nombres (`name`) de los permisos en vez de los IDs reales (`id`).
- Se realizó consulta de permisos existentes usando `/api/permissions` y Prisma Studio, y se validó que los IDs enviados correspondieran a los registros de la base de datos.
- Se probó con éxito la asignación de permisos al rol desde Postman y se validó la actualización correcta en la base de datos.
- Se deja pendiente para mañana la integración y prueba del flujo completo desde el frontend (Angular).